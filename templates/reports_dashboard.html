{% extends "base_fixed.html" %}

{% block title %}Reports & Export - VendorTime{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="fas fa-chart-bar me-2"></i>Reports & Export</h2>
            <div>
                <button class="btn btn-success me-2" onclick="scheduleReport()">
                    <i class="fas fa-clock me-1"></i>Schedule Report
                </button>
                <button class="btn btn-info" onclick="viewReportHistory()">
                    <i class="fas fa-history me-1"></i>Report History
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Report Statistics -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6 class="card-title">Monthly Reports</h6>
                        <h4 class="mb-0">{{ stats.monthly_reports or 12 }}</h4>
                        <small>Generated this year</small>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-file-excel fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6 class="card-title">Billing Summaries</h6>
                        <h4 class="mb-0">{{ stats.billing_reports or 8 }}</h4>
                        <small>Ready for invoicing</small>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-file-invoice-dollar fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6 class="card-title">Analytics Reports</h6>
                        <h4 class="mb-0">{{ stats.analytics_reports or 15 }}</h4>
                        <small>Generated this month</small>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-chart-line fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6 class="card-title">Scheduled Reports</h6>
                        <h4 class="mb-0">{{ stats.scheduled_reports or 5 }}</h4>
                        <small>Active schedules</small>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-calendar-check fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Report Generation Interface -->
<div class="row">
    <div class="col-md-8">
        <!-- Monthly Attendance Report -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>Monthly Attendance Reports</h5>
            </div>
            <div class="card-body">
                <form id="monthlyReportForm">
                    <div class="row">
                        <div class="col-md-4">
                            <label for="reportMonth" class="form-label">Select Month</label>
                            <input type="month" class="form-control" id="reportMonth" value="2025-09" required>
                        </div>
                        <div class="col-md-4">
                            <label for="reportManager" class="form-label">Manager (Optional)</label>
                            <select class="form-control" id="reportManager">
                                <option value="">All Managers</option>
                                <option value="manager1">Manager 1 - Team Alpha</option>
                                <option value="manager2">Manager 2 - Team Beta</option>
                                <option value="manager3">Manager 3 - Team Gamma</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="reportFormat" class="form-label">Export Format</label>
                            <select class="form-control" id="reportFormat" required>
                                <option value="excel">Excel (.xlsx)</option>
                                <option value="pdf">PDF Report</option>
                                <option value="csv">CSV Data</option>
                                <option value="json">JSON Data</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="includeCharts" checked>
                                <label class="form-check-label" for="includeCharts">
                                    Include Charts & Graphs
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="includeSummary" checked>
                                <label class="form-check-label" for="includeSummary">
                                    Include Summary Statistics
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="includeDetails">
                                <label class="form-check-label" for="includeDetails">
                                    Include Daily Details
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="includeMismatches">
                                <label class="form-check-label" for="includeMismatches">
                                    Include Mismatch Report
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <button type="submit" class="btn btn-primary me-2">
                            <i class="fas fa-download me-1"></i>Generate & Download
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="previewReport('monthly')">
                            <i class="fas fa-eye me-1"></i>Preview Report
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Billing Summary Report -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-file-invoice-dollar me-2"></i>Billing Summary Reports</h5>
            </div>
            <div class="card-body">
                <form id="billingReportForm">
                    <div class="row">
                        <div class="col-md-4">
                            <label for="billingMonth" class="form-label">Billing Period</label>
                            <input type="month" class="form-control" id="billingMonth" value="2025-09" required>
                        </div>
                        <div class="col-md-4">
                            <label for="billingClient" class="form-label">Client Company</label>
                            <select class="form-control" id="billingClient" required>
                                <option value="all">All Companies</option>
                                <option value="attendo">Attendo Corporation</option>
                                <option value="abc-solutions">ABC Solutions</option>
                                <option value="tech-innovations">Tech Innovations Ltd</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="billingRate" class="form-label">Billing Rate (per day)</label>
                            <input type="number" class="form-control" id="billingRate" placeholder="1500" step="100">
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Billing Summary includes:</strong> Working days, leave days, overtime calculations, 
                                total billable amount, tax calculations, and detailed vendor-wise breakdown.
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <button type="submit" class="btn btn-success me-2">
                            <i class="fas fa-file-invoice me-1"></i>Generate Invoice Ready Report
                        </button>
                        <button type="button" class="btn btn-outline-primary" onclick="previewReport('billing')">
                            <i class="fas fa-calculator me-1"></i>Calculate Preview
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Analytics & Insights Report -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Analytics & Insights</h5>
            </div>
            <div class="card-body">
                <form id="analyticsReportForm">
                    <div class="row">
                        <div class="col-md-6">
                            <label for="analyticsDateRange" class="form-label">Date Range</label>
                            <select class="form-control" id="analyticsDateRange" required>
                                <option value="current-month">Current Month</option>
                                <option value="last-3-months">Last 3 Months</option>
                                <option value="last-6-months">Last 6 Months</option>
                                <option value="yearly">Current Year</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="analyticsType" class="form-label">Report Type</label>
                            <select class="form-control" id="analyticsType" required>
                                <option value="attendance-trends">Attendance Trends</option>
                                <option value="productivity-analysis">Productivity Analysis</option>
                                <option value="wfh-patterns">WFH Usage Patterns</option>
                                <option value="leave-analysis">Leave Analysis</option>
                                <option value="mismatch-trends">Mismatch Trends</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row mt-3" id="customDateRange" style="display: none;">
                        <div class="col-md-6">
                            <label for="startDate" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="startDate">
                        </div>
                        <div class="col-md-6">
                            <label for="endDate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="endDate">
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <button type="submit" class="btn btn-info me-2">
                            <i class="fas fa-chart-bar me-1"></i>Generate Analytics Report
                        </button>
                        <button type="button" class="btn btn-outline-warning" onclick="generateDashboard()">
                            <i class="fas fa-tachometer-alt me-1"></i>Create Dashboard
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Quick Reports & Actions -->
    <div class="col-md-4">
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Reports</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <button class="btn btn-primary" onclick="quickReport('today')">
                        <i class="fas fa-calendar-day me-2"></i>Today's Summary
                    </button>
                    <button class="btn btn-success" onclick="quickReport('week')">
                        <i class="fas fa-calendar-week me-2"></i>This Week Report
                    </button>
                    <button class="btn btn-info" onclick="quickReport('month')">
                        <i class="fas fa-calendar-alt me-2"></i>Current Month
                    </button>
                    <button class="btn btn-warning" onclick="quickReport('pending')">
                        <i class="fas fa-exclamation-circle me-2"></i>Pending Approvals
                    </button>
                    <button class="btn btn-danger" onclick="quickReport('mismatches')">
                        <i class="fas fa-exclamation-triangle me-2"></i>Active Mismatches
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Report Templates -->
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>Report Templates</h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    <div class="list-group-item d-flex justify-content-between align-items-center p-2">
                        <span class="small">
                            <i class="fas fa-file-excel text-success me-2"></i>
                            Monthly Attendance
                        </span>
                        <button class="btn btn-sm btn-outline-primary" onclick="useTemplate('monthly')">Use</button>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center p-2">
                        <span class="small">
                            <i class="fas fa-file-invoice text-warning me-2"></i>
                            Billing Summary
                        </span>
                        <button class="btn btn-sm btn-outline-primary" onclick="useTemplate('billing')">Use</button>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center p-2">
                        <span class="small">
                            <i class="fas fa-chart-pie text-info me-2"></i>
                            Executive Dashboard
                        </span>
                        <button class="btn btn-sm btn-outline-primary" onclick="useTemplate('executive')">Use</button>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center p-2">
                        <span class="small">
                            <i class="fas fa-exclamation text-danger me-2"></i>
                            Compliance Report
                        </span>
                        <button class="btn btn-sm btn-outline-primary" onclick="useTemplate('compliance')">Use</button>
                    </div>
                </div>
                
                <div class="mt-2">
                    <button class="btn btn-sm btn-success w-100" onclick="createCustomTemplate()">
                        <i class="fas fa-plus me-1"></i>Create Custom Template
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Recent Reports -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-history me-2"></i>Recent Reports</h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    <div class="list-group-item d-flex justify-content-between align-items-start p-2">
                        <div>
                            <h6 class="mb-1 small">September 2025 Attendance</h6>
                            <small class="text-muted">Generated: 2 hours ago</small>
                        </div>
                        <button class="btn btn-sm btn-outline-secondary" onclick="downloadReport('sept-2025')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-start p-2">
                        <div>
                            <h6 class="mb-1 small">Billing Summary - Attendo</h6>
                            <small class="text-muted">Generated: Yesterday</small>
                        </div>
                        <button class="btn btn-sm btn-outline-secondary" onclick="downloadReport('billing-attendo')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-start p-2">
                        <div>
                            <h6 class="mb-1 small">WFH Analytics Q3</h6>
                            <small class="text-muted">Generated: 3 days ago</small>
                        </div>
                        <button class="btn btn-sm btn-outline-secondary" onclick="downloadReport('wfh-q3')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                
                <div class="mt-2">
                    <button class="btn btn-sm btn-outline-primary w-100" onclick="viewAllReports()">
                        <i class="fas fa-list me-1"></i>View All Reports
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Custom Styles -->
<style>
.form-check {
    margin-bottom: 0.5rem;
}

.list-group-item {
    border-left: none;
    border-right: none;
}

.alert-info {
    background-color: #e7f3ff;
    border-color: #b3d7ff;
    color: #004085;
}
</style>

<!-- JavaScript for Reports Dashboard -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Reports Dashboard loaded');
    
    // Handle custom date range visibility
    document.getElementById('analyticsDateRange').addEventListener('change', function(e) {
        const customDateRange = document.getElementById('customDateRange');
        if (e.target.value === 'custom') {
            customDateRange.style.display = 'flex';
        } else {
            customDateRange.style.display = 'none';
        }
    });
    
    // Form submissions
    document.getElementById('monthlyReportForm').addEventListener('submit', function(e) {
        e.preventDefault();
        generateMonthlyReport();
    });
    
    document.getElementById('billingReportForm').addEventListener('submit', function(e) {
        e.preventDefault();
        generateBillingReport();
    });
    
    document.getElementById('analyticsReportForm').addEventListener('submit', function(e) {
        e.preventDefault();
        generateAnalyticsReport();
    });
});

function generateMonthlyReport() {
    const formData = {
        month: document.getElementById('reportMonth').value,
        manager: document.getElementById('reportManager').value,
        format: document.getElementById('reportFormat').value,
        includeCharts: document.getElementById('includeCharts').checked,
        includeSummary: document.getElementById('includeSummary').checked,
        includeDetails: document.getElementById('includeDetails').checked,
        includeMismatches: document.getElementById('includeMismatches').checked
    };
    
    console.log('Generating monthly report:', formData);
    showReportGenerating();
    
    setTimeout(() => {
        hideReportGenerating();
        alert(`Monthly report generated successfully!\\n\\nReport Details:\\n- Period: ${formData.month}\\n- Format: ${formData.format.toUpperCase()}\\n- Manager: ${formData.manager || 'All Managers'}\\n\\nReport would be downloaded automatically.`);
    }, 2000);
}

function generateBillingReport() {
    const formData = {
        month: document.getElementById('billingMonth').value,
        client: document.getElementById('billingClient').value,
        rate: document.getElementById('billingRate').value
    };
    
    console.log('Generating billing report:', formData);
    showReportGenerating();
    
    setTimeout(() => {
        hideReportGenerating();
        alert(`Billing summary generated successfully!\\n\\nBilling Details:\\n- Period: ${formData.month}\\n- Client: ${formData.client}\\n- Daily Rate: ₹${formData.rate || 1500}\\n\\nEstimated Amount: ₹${(parseInt(formData.rate || 1500) * 22 * 45).toLocaleString()}\\n\\nReport ready for invoicing!`);
    }, 2000);
}

function generateAnalyticsReport() {
    const formData = {
        dateRange: document.getElementById('analyticsDateRange').value,
        type: document.getElementById('analyticsType').value,
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value
    };
    
    console.log('Generating analytics report:', formData);
    showReportGenerating();
    
    setTimeout(() => {
        hideReportGenerating();
        alert(`Analytics report generated successfully!\\n\\nAnalytics Details:\\n- Type: ${formData.type.replace('-', ' ')}\\n- Period: ${formData.dateRange.replace('-', ' ')}\\n\\nReport includes comprehensive insights and visualizations.`);
    }, 2000);
}

function previewReport(type) {
    alert(`Report Preview (${type})\\n\\nThis would show a preview of the report with sample data, charts, and formatting before generating the final version.`);
}

function quickReport(type) {
    const reportTypes = {
        'today': "Today's Attendance Summary",
        'week': "This Week's Report",
        'month': "Current Month Report",
        'pending': "Pending Approvals Report",
        'mismatches': "Active Mismatches Report"
    };
    
    showReportGenerating();
    
    setTimeout(() => {
        hideReportGenerating();
        alert(`${reportTypes[type]} generated successfully!\\n\\nQuick report ready for download.`);
    }, 1000);
}

function useTemplate(template) {
    const templates = {
        'monthly': 'Monthly Attendance Template',
        'billing': 'Billing Summary Template',
        'executive': 'Executive Dashboard Template',
        'compliance': 'Compliance Report Template'
    };
    
    alert(`Using ${templates[template]}\\n\\nTemplate loaded with pre-configured settings and formatting.`);
}

function createCustomTemplate() {
    alert('Create Custom Template\\n\\nThis would open a template builder where you can:\\n- Define custom fields\\n- Set up formatting\\n- Configure charts and graphs\\n- Save for future use');
}

function downloadReport(reportId) {
    alert(`Downloading report: ${reportId}\\n\\nReport download started...`);
}

function viewAllReports() {
    alert('View All Reports\\n\\nThis would show a complete list of all generated reports with search, filter, and download options.');
}

function scheduleReport() {
    alert('Schedule Report\\n\\nThis would allow you to:\\n- Set up recurring reports\\n- Configure delivery emails\\n- Set custom schedules\\n- Manage automated reporting');
}

function viewReportHistory() {
    alert('Report History\\n\\nThis would show:\\n- All generated reports\\n- Generation timestamps\\n- Download history\\n- Report performance metrics');
}

function generateDashboard() {
    alert('Generate Dashboard\\n\\nThis would create an interactive dashboard with:\\n- Real-time charts\\n- Key metrics\\n- Drill-down capabilities\\n- Export options');
}

function showReportGenerating() {
    // Show loading indicator
    const buttons = document.querySelectorAll('button[type="submit"]');
    buttons.forEach(btn => {
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Generating...';
    });
}

function hideReportGenerating() {
    // Hide loading indicator
    const buttons = document.querySelectorAll('button[type="submit"]');
    buttons.forEach(btn => {
        btn.disabled = false;
    });
    
    // Restore original button text
    document.querySelector('#monthlyReportForm button[type="submit"]').innerHTML = '<i class="fas fa-download me-1"></i>Generate & Download';
    document.querySelector('#billingReportForm button[type="submit"]').innerHTML = '<i class="fas fa-file-invoice me-1"></i>Generate Invoice Ready Report';
    document.querySelector('#analyticsReportForm button[type="submit"]').innerHTML = '<i class="fas fa-chart-bar me-1"></i>Generate Analytics Report';
}
</script>
{% endblock %}
